# Publishing to Chrome Web Store (automatic via GitHub Actions)

This document explains how to obtain the credentials required to publish the extension automatically from GitHub Actions.

Required GitHub secrets

- `WEBSTORE_CLIENT_ID`
- `WEBSTORE_CLIENT_SECRET`
- `WEBSTORE_REFRESH_TOKEN`
- `WEBSTORE_ITEM_ID`

How to obtain the credentials

1. Create a Google Cloud project and enable the **Chrome Web Store API**:
   - Go to https://console.cloud.google.com/
   - Create a new project (or select an existing one).
   - Open the APIs & Services dashboard and enable the **Chrome Web Store API**.

2. Create OAuth 2.0 credentials (Client ID and Client Secret):
   - In the Cloud Console, go to **APIs & Services > Credentials**.
   - Create an OAuth client ID of type **Desktop app** (recommended for generating a refresh token) or **Web application**.
   - Save the `client_id` and `client_secret`.

3. Obtain a refresh token (manual OAuth consent):
   - Construct an OAuth authorization URL like this (replace CLIENT_ID):

```
https://accounts.google.com/o/oauth2/v2/auth?response_type=code&client_id=CLIENT_ID&scope=https://www.googleapis.com/auth/chromewebstore&access_type=offline&prompt=consent
```

   - Visit the URL in a browser, authorize the app and copy the `code` parameter from the redirect URL.
   - Exchange the code for tokens:

```
curl --request POST \
  --data "code=THE_CODE&client_id=CLIENT_ID&client_secret=CLIENT_SECRET&grant_type=authorization_code&redirect_uri=urn:ietf:wg:oauth:2.0:oob" \
  https://oauth2.googleapis.com/token
```

   - The response includes an `access_token` and a `refresh_token`. Save the `refresh_token`.

4. Find your Chrome Web Store item ID:
   - In the Chrome Developer Dashboard (https://chrome.google.com/webstore/devconsole), open your extension and note the **Item ID** (a 32-character ID).

5. Store secrets in GitHub:
   - In your GitHub repository, go to Settings → Secrets → Actions and add the four secrets above.

6. Trigger release:
   - Create a Git tag (e.g. `v1.0.0`) and push it; the GitHub Actions workflow will build, package and create a release and (if the secrets are present) publish to the Chrome Web Store.

Notes and troubleshooting

- The workflow runs `npm ci` and `npm run generate-icons` (which depends on `sharp`) in CI. The Ubuntu runner will compile native modules; if there are issues, you may prefer to generate icons locally and commit them.
- For security, keep your client secret and refresh token private.
- If you prefer to publish manually, you can use the Chrome Web Store Developer Dashboard to upload `dist/extension.zip` generated by the workflow or by running the packaging steps locally.

